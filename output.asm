; --- Encabezado y Directivas (MASM 32-bit) ---
.386
option casemap:none
includelib \masm32\lib\kernel32.lib
include \masm32\include\masm32rt.inc
printf PROTO C : VARARG

; Las rutinas de impresi칩n se manejar치n con invoke printf de masm32rt.inc

.DATA
; Variables Auxiliares (DD ?) y Constantes

; Formatos de printf para rutinas de I/O
_FMT_INT	DB "%d", 0
_FMT_FLOAT	DB "%.10f", 0
_FMT_STRING	DB "%s", 0
_X_PROGRAMARUNTIMECHECK_FRECURSIVA	DD ?
_A_PROGRAMARUNTIMECHECK_FRECURSIVA	DD ?
_CTE_3_5	DD 3.5
_@T1_PROGRAMARUNTIMECHECK_FRECURSIVA	DD ?
_DIVISOR_PROGRAMARUNTIMECHECK	DD ?
_RESULTADO_PROGRAMARUNTIMECHECK	DD ?
_MAXVAL_PROGRAMARUNTIMECHECK	DD ?
_RESULTADOFLOAT_PROGRAMARUNTIMECHECK	DD ?
_CTE_0I	DD 0
_CTE_3_40282347F_38	DD 3.40282347E+38
_CTE_2_0	DD 2.0
_@T2_PROGRAMARUNTIMECHECK	DD ?
_@T3_PROGRAMARUNTIMECHECK	DD ?
_CTE_FIN_PRUEBAS_DE_FALLO	DB "FIN PRUEBAS DE FALLO", 0
_CTE_1	DD 1
_SALTO_LINEA	DB 0Dh, 0Ah, 0

; Rutinas de error de Runtime
_ERR_CAPTION	DB "Error de Ejecucion", 0
_DIV_CERO	DB "Error en runtime: Division por cero!", 0
_OVERFLOW_FLOAT	DB "Error en runtime: Overflow de flotante!", 0
_RECURSION_ERR	DB "Error en runtime: Recursion directa prohibida!", 0

.CODE
; Rutina de error para divisi칩n por cero
_RTH_DIV_CERO:
	INVOKE MessageBox, NULL, ADDR _DIV_CERO, ADDR _ERR_CAPTION, MB_OK + MB_ICONSTOP
	JMP _EXIT_PROGRAM
; Rutina de error para Overflow de flotante
_RTH_OVERFLOW_FLOAT:
	INVOKE MessageBox, NULL, ADDR _OVERFLOW_FLOAT, ADDR _ERR_CAPTION, MB_OK + MB_ICONSTOP
	JMP _EXIT_PROGRAM
; Rutina de error para recursi칩n directa
_RTH_RECURSION_DIRECTA:
	INVOKE MessageBox, NULL, ADDR _RECURSION_ERR, ADDR _ERR_CAPTION, MB_OK + MB_ICONSTOP
	JMP _EXIT_PROGRAM

_FRECURSIVA_PROGRAMARUNTIMECHECK PROC
	PUSH EBP
	MOV EBP, ESP

	; --- Traduccion Polaca Inversa (FRECURSIVA:PROGRAMARUNTIMECHECK) ---
L_1:
	; ERROR: Instruccion 'PROC_FRECURSIVA:PROGRAMARUNTIMECHECK' no implementada.
L_2:
	; OPERANDO OMITIDO
L_3:
	; OPERANDO OMITIDO
L_4:
	FLD DWORD PTR _CTE_3_5
	FSTP DWORD PTR _A_PROGRAMARUNTIMECHECK_FRECURSIVA
L_5:
	; OPERANDO OMITIDO
L_6:
	; OPERANDO OMITIDO
L_7:
	FLD DWORD PTR _A_PROGRAMARUNTIMECHECK_FRECURSIVA
	FSTP DWORD PTR _X_PROGRAMARUNTIMECHECK_FRECURSIVA
L_8:
	; OPERANDO OMITIDO
L_9:
	JMP _RTH_RECURSION_DIRECTA
L_10:
	; OPERANDO OMITIDO
L_11:
	; ASIGNACION REDUNDANTE OMITIDA (Operando no es SymbolEntry)
L_12:
	; OPERANDO OMITIDO
L_13:
	; OPERANDO OMITIDO
L_14:
	FLD DWORD PTR _X_PROGRAMARUNTIMECHECK_FRECURSIVA
	FSTP DWORD PTR _A_PROGRAMARUNTIMECHECK_FRECURSIVA
L_15:
	JMP _FRECURSIVA_PROGRAMARUNTIMECHECK_EPILOGUE
L_16:
	; ERROR: Instruccion 'ENDP_FRECURSIVA:PROGRAMARUNTIMECHECK' no implementada.

	; --- Fin Traduccion Polaca Inversa ---
_FRECURSIVA_PROGRAMARUNTIMECHECK_EPILOGUE:
	MOV ESP, EBP
	POP EBP
	RET
_FRECURSIVA_PROGRAMARUNTIMECHECK ENDP

start:
	CALL _PROGRAMARUNTIMECHECK_PROGRAMARUNTIMECHECK
_EXIT_PROGRAM:
	INVOKE ExitProcess, 0

_PROGRAMARUNTIMECHECK_PROGRAMARUNTIMECHECK PROC
	PUSH EBP
	MOV EBP, ESP

	; --- Traduccion Polaca Inversa (PROGRAMARUNTIMECHECK:PROGRAMARUNTIMECHECK) ---
L_1:
	; OPERANDO OMITIDO
L_2:
	; OPERANDO OMITIDO
L_3:
	MOV EAX, _CTE_0I
	MOV _DIVISOR_PROGRAMARUNTIMECHECK, EAX
L_4:
	; OPERANDO OMITIDO
L_5:
	; OPERANDO OMITIDO
L_6:
	FLD DWORD PTR _CTE_3_40282347F_38
	FSTP DWORD PTR _MAXVAL_PROGRAMARUNTIMECHECK
L_7:
	; OPERANDO OMITIDO
L_8:
	; OPERANDO OMITIDO
L_9:
	FLD DWORD PTR _MAXVAL_PROGRAMARUNTIMECHECK
	FLD DWORD PTR _CTE_2_0
	FMUL
	FSTP DWORD PTR _@T2_PROGRAMARUNTIMECHECK
	; Chequeo REAL de Overflow conversion a float32
	MOV EAX, DWORD PTR _@T2_PROGRAMARUNTIMECHECK
	CMP EAX, 07F800000h
	JE _RTH_OVERFLOW_FLOAT
	CMP EAX, 0FF800000h
	JE _RTH_OVERFLOW_FLOAT
L_10:
	; OPERANDO OMITIDO
L_11:
	; ASIGNACION REDUNDANTE OMITIDA (Operando no es SymbolEntry)
L_12:
	; OPERANDO OMITIDO
L_13:
	; OPERANDO OMITIDO
L_14:
	FLD DWORD PTR _@T2_PROGRAMARUNTIMECHECK
	FSTP DWORD PTR _RESULTADOFLOAT_PROGRAMARUNTIMECHECK
L_15:
	; OPERANDO OMITIDO
L_16:
	; OPERANDO OMITIDO
L_17:
	FLD DWORD PTR _MAXVAL_PROGRAMARUNTIMECHECK
	FSTP DWORD PTR _X_PROGRAMARUNTIMECHECK_FRECURSIVA
L_18:
	; OPERANDO OMITIDO
L_19:
	CALL _FRECURSIVA_PROGRAMARUNTIMECHECK
L_20:
	; OPERANDO OMITIDO
L_21:
	; ASIGNACION REDUNDANTE OMITIDA (Operando no es SymbolEntry)
L_22:
	; OPERANDO OMITIDO
L_23:
	; OPERANDO OMITIDO
L_24:
	FLD DWORD PTR _X_PROGRAMARUNTIMECHECK_FRECURSIVA
	FSTP DWORD PTR _MAXVAL_PROGRAMARUNTIMECHECK
L_25:
	; OPERANDO OMITIDO
L_26:
	; OPERANDO OMITIDO
L_27:
	FLD DWORD PTR _@T3_PROGRAMARUNTIMECHECK
	FSTP DWORD PTR _RESULTADOFLOAT_PROGRAMARUNTIMECHECK
L_28:
	; OPERANDO OMITIDO
L_29:
	PUSH OFFSET _CTE_FIN_PRUEBAS_DE_FALLO
	PUSH OFFSET _FMT_STRING
	CALL printf
	ADD ESP, 8

	; Salto de linea forzado
	PUSH OFFSET _SALTO_LINEA
	PUSH OFFSET _FMT_STRING
	CALL printf
	ADD ESP, 8

	; --- Fin Traduccion Polaca Inversa ---
_PROGRAMARUNTIMECHECK_PROGRAMARUNTIMECHECK_EPILOGUE:
	MOV ESP, EBP
	POP EBP
	RET
_PROGRAMARUNTIMECHECK_PROGRAMARUNTIMECHECK ENDP
END start
